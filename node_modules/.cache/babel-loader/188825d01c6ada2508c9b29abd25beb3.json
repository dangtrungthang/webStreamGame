{"ast":null,"code":"\"use strict\";\n/**\r\n * ViewBase.tsx\r\n *\r\n * Copyright (c) Microsoft Corporation. All rights reserved.\r\n * Licensed under the MIT license.\r\n *\r\n * A base class for the Web-specific implementation of the cross-platform View abstraction.\r\n */\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.ViewBase = void 0;\n\nvar AppConfig_1 = require(\"../common/AppConfig\");\n\nvar RX = require(\"../common/Interfaces\");\n\nvar PromiseDefer_1 = require(\"../common/utils/PromiseDefer\");\n\nvar Timers_1 = require(\"../common/utils/Timers\");\n\nvar FrontLayerViewManager_1 = require(\"./FrontLayerViewManager\");\n\nvar _ = require(\"./utils/lodashMini\"); // We create a periodic timer to detect layout changes that are performed behind\n// our back by the browser's layout engine. We do this more aggressively when\n// the app is known to be active and in the foreground.\n\n\nvar _layoutTimerActiveDuration = 1000;\nvar _layoutTimerInactiveDuration = 10000;\n\nvar ViewBase =\n/** @class */\nfunction (_super) {\n  __extends(ViewBase, _super);\n\n  function ViewBase() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this._isMounted = false;\n    _this._isPopupDisplayed = false;\n    _this._lastX = 0;\n    _this._lastY = 0;\n    _this._lastWidth = 0;\n    _this._lastHeight = 0;\n    return _this;\n  } // Sets the activation state so we can stop our periodic timer\n  // when the app is in the background.\n\n\n  ViewBase.setActivationState = function (newState) {\n    if (ViewBase._appActivationState !== newState) {\n      ViewBase._appActivationState = newState; // Cancel any existing timers.\n\n      if (ViewBase._viewCheckingTimer) {\n        Timers_1.default.clearInterval(ViewBase._viewCheckingTimer);\n        ViewBase._viewCheckingTimer = undefined;\n      }\n\n      if (ViewBase._viewCheckingList.length > 0) {\n        // If we're becoming active, check and report layout changes immediately.\n        if (newState === RX.Types.AppActivationState.Active) {\n          ViewBase._checkViews();\n        }\n\n        ViewBase._viewCheckingTimer = Timers_1.default.setInterval(ViewBase._checkViews, newState === RX.Types.AppActivationState.Active ? _layoutTimerActiveDuration : _layoutTimerInactiveDuration);\n      }\n    }\n  };\n\n  ViewBase.prototype.UNSAFE_componentWillReceiveProps = function (nextProps) {\n    if (!!this.props.onLayout !== !!nextProps.onLayout) {\n      if (this.props.onLayout) {\n        this._checkViewCheckerUnbuild();\n      }\n\n      if (nextProps.onLayout) {\n        this._checkViewCheckerBuild();\n      }\n    }\n  };\n\n  ViewBase._checkViews = function () {\n    _.each(ViewBase._viewCheckingList, function (view) {\n      view._checkAndReportLayout().catch(function (e) {\n        console.warn('ScrollView onLayout exception: ' + JSON.stringify(e));\n      });\n    });\n  };\n\n  ViewBase._reportLayoutChange = function (func) {\n    this._layoutReportList.push(func);\n\n    if (!ViewBase._layoutReportingTimer) {\n      ViewBase._layoutReportingTimer = Timers_1.default.setTimeout(function () {\n        ViewBase._layoutReportingTimer = undefined;\n\n        ViewBase._reportDeferredLayoutChanges();\n      }, 0);\n    }\n  };\n\n  ViewBase._reportDeferredLayoutChanges = function () {\n    var reportList = this._layoutReportList;\n    this._layoutReportList = [];\n\n    _.each(reportList, function (func) {\n      try {\n        func();\n      } catch (e) {\n        if (AppConfig_1.default.isDevelopmentMode()) {\n          console.error('Caught exception on onLayout response: ', e);\n        }\n      }\n    });\n  }; // Returns a promise to indicate when firing of onLayout event has completed (if any)\n\n\n  ViewBase.prototype._checkAndReportLayout = function () {\n    var _this = this;\n\n    if (!this._isMounted) {\n      return Promise.resolve(void 0);\n    }\n\n    var container = this._getContainer();\n\n    if (!container) {\n      return Promise.resolve(void 0);\n    }\n\n    var newX = container.offsetLeft;\n    var newY = container.offsetTop;\n    var marginTop = !container.style.marginTop ? 0 : parseInt(container.style.marginTop, 10) || 0;\n    var marginBottom = !container.style.marginBottom ? 0 : parseInt(container.style.marginBottom, 10) || 0;\n    var marginRight = !container.style.marginRight ? 0 : parseInt(container.style.marginRight, 10) || 0;\n    var marginLeft = !container.style.marginLeft ? 0 : parseInt(container.style.marginLeft, 10) || 0;\n    var newWidth = container.offsetWidth + marginRight + marginLeft;\n    var newHeight = container.offsetHeight + marginTop + marginBottom;\n\n    if (this._lastX !== newX || this._lastY !== newY || this._lastWidth !== newWidth || this._lastHeight !== newHeight) {\n      this._lastX = newX;\n      this._lastY = newY;\n      this._lastWidth = newWidth;\n      this._lastHeight = newHeight;\n      var deferred_1 = new PromiseDefer_1.Defer();\n\n      ViewBase._reportLayoutChange(function () {\n        if (!_this._isMounted || !_this.props.onLayout) {\n          deferred_1.resolve(void 0);\n          return;\n        }\n\n        _this.props.onLayout({\n          x: newX,\n          y: newY,\n          width: _this._lastWidth,\n          height: _this._lastHeight\n        });\n\n        deferred_1.resolve(void 0);\n      });\n\n      return deferred_1.promise();\n    }\n\n    return Promise.resolve(void 0);\n  };\n\n  ViewBase.prototype._checkViewCheckerBuild = function () {\n    // Enable the timer to check for layout changes. Use a different duration\n    // when the app is active versus inactive.\n    if (!ViewBase._viewCheckingTimer) {\n      ViewBase._viewCheckingTimer = Timers_1.default.setInterval(ViewBase._checkViews, ViewBase._appActivationState === RX.Types.AppActivationState.Active ? _layoutTimerActiveDuration : _layoutTimerInactiveDuration);\n    }\n\n    if (!ViewBase._isResizeHandlerInstalled) {\n      window.addEventListener('resize', ViewBase._onResize);\n      ViewBase._isResizeHandlerInstalled = true;\n    }\n\n    ViewBase._viewCheckingList.push(this);\n  };\n\n  ViewBase.prototype._checkViewCheckerUnbuild = function () {\n    var _this = this;\n\n    ViewBase._viewCheckingList = _.filter(ViewBase._viewCheckingList, function (v) {\n      return v !== _this;\n    });\n\n    if (ViewBase._viewCheckingList.length === 0) {\n      if (ViewBase._viewCheckingTimer) {\n        Timers_1.default.clearInterval(ViewBase._viewCheckingTimer);\n        ViewBase._viewCheckingTimer = undefined;\n      }\n\n      if (ViewBase._isResizeHandlerInstalled) {\n        window.removeEventListener('resize', ViewBase._onResize);\n        ViewBase._isResizeHandlerInstalled = false;\n      }\n    }\n  };\n\n  ViewBase.prototype.componentDidMount = function () {\n    this._isMounted = true;\n\n    if (this.props.onLayout) {\n      this._checkViewCheckerBuild();\n    } // Chain through to the same render-checking code\n\n\n    this.componentDidUpdate();\n  };\n\n  ViewBase.prototype.componentDidUpdate = function () {\n    var _this = this;\n\n    var isPopupDisplayed = FrontLayerViewManager_1.default.isPopupDisplayed();\n\n    if (this.props.onLayout) {\n      if (isPopupDisplayed && !this._isPopupDisplayed) {\n        // A popup was just added to DOM. Checking layout now would stall script\n        // execution because the browser would have to do a reflow. Avoid that\n        // by deferring the work.\n        setTimeout(function () {\n          _this._checkAndReportLayout().catch(function (e) {\n            console.warn('ScrollView onLayout exception: ' + JSON.stringify(e));\n          });\n        }, 0);\n      } else {\n        this._checkAndReportLayout().catch(function (e) {\n          console.warn('ScrollView onLayout exception: ' + JSON.stringify(e));\n        });\n      }\n    }\n\n    this._isPopupDisplayed = isPopupDisplayed;\n  };\n\n  ViewBase._onResize = function () {\n    // Often views change size in response to an overall window resize. Rather than\n    // wait for the next timer to fire, do it immediately.\n    ViewBase._checkViews();\n  };\n\n  ViewBase.prototype.componentWillUnmount = function () {\n    this._isMounted = false;\n\n    if (this.props.onLayout) {\n      this._checkViewCheckerUnbuild();\n    }\n  };\n\n  ViewBase._isResizeHandlerInstalled = false;\n  ViewBase._viewCheckingList = [];\n  ViewBase._appActivationState = RX.Types.AppActivationState.Active;\n  ViewBase._layoutReportList = [];\n  return ViewBase;\n}(RX.ViewBase);\n\nexports.ViewBase = ViewBase;\nexports.default = ViewBase;","map":{"version":3,"sources":["/Users/trungthang/webStreamGame/webStreamGame/node_modules/react-ult/dist/web/ViewBase.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","__","constructor","create","defineProperty","exports","value","ViewBase","AppConfig_1","require","RX","PromiseDefer_1","Timers_1","FrontLayerViewManager_1","_","_layoutTimerActiveDuration","_layoutTimerInactiveDuration","_super","_this","apply","arguments","_isMounted","_isPopupDisplayed","_lastX","_lastY","_lastWidth","_lastHeight","setActivationState","newState","_appActivationState","_viewCheckingTimer","default","clearInterval","undefined","_viewCheckingList","length","Types","AppActivationState","Active","_checkViews","setInterval","UNSAFE_componentWillReceiveProps","nextProps","props","onLayout","_checkViewCheckerUnbuild","_checkViewCheckerBuild","each","view","_checkAndReportLayout","catch","e","console","warn","JSON","stringify","_reportLayoutChange","func","_layoutReportList","push","_layoutReportingTimer","setTimeout","_reportDeferredLayoutChanges","reportList","isDevelopmentMode","error","Promise","resolve","container","_getContainer","newX","offsetLeft","newY","offsetTop","marginTop","style","parseInt","marginBottom","marginRight","marginLeft","newWidth","offsetWidth","newHeight","offsetHeight","deferred_1","Defer","x","y","width","height","promise","_isResizeHandlerInstalled","window","addEventListener","_onResize","filter","v","removeEventListener","componentDidMount","componentDidUpdate","isPopupDisplayed","componentWillUnmount"],"mappings":"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","sourcesContent":["\"use strict\";\r\n/**\r\n * ViewBase.tsx\r\n *\r\n * Copyright (c) Microsoft Corporation. All rights reserved.\r\n * Licensed under the MIT license.\r\n *\r\n * A base class for the Web-specific implementation of the cross-platform View abstraction.\r\n */\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.ViewBase = void 0;\r\nvar AppConfig_1 = require(\"../common/AppConfig\");\r\nvar RX = require(\"../common/Interfaces\");\r\nvar PromiseDefer_1 = require(\"../common/utils/PromiseDefer\");\r\nvar Timers_1 = require(\"../common/utils/Timers\");\r\nvar FrontLayerViewManager_1 = require(\"./FrontLayerViewManager\");\r\nvar _ = require(\"./utils/lodashMini\");\r\n// We create a periodic timer to detect layout changes that are performed behind\r\n// our back by the browser's layout engine. We do this more aggressively when\r\n// the app is known to be active and in the foreground.\r\nvar _layoutTimerActiveDuration = 1000;\r\nvar _layoutTimerInactiveDuration = 10000;\r\nvar ViewBase = /** @class */ (function (_super) {\r\n    __extends(ViewBase, _super);\r\n    function ViewBase() {\r\n        var _this = _super !== null && _super.apply(this, arguments) || this;\r\n        _this._isMounted = false;\r\n        _this._isPopupDisplayed = false;\r\n        _this._lastX = 0;\r\n        _this._lastY = 0;\r\n        _this._lastWidth = 0;\r\n        _this._lastHeight = 0;\r\n        return _this;\r\n    }\r\n    // Sets the activation state so we can stop our periodic timer\r\n    // when the app is in the background.\r\n    ViewBase.setActivationState = function (newState) {\r\n        if (ViewBase._appActivationState !== newState) {\r\n            ViewBase._appActivationState = newState;\r\n            // Cancel any existing timers.\r\n            if (ViewBase._viewCheckingTimer) {\r\n                Timers_1.default.clearInterval(ViewBase._viewCheckingTimer);\r\n                ViewBase._viewCheckingTimer = undefined;\r\n            }\r\n            if (ViewBase._viewCheckingList.length > 0) {\r\n                // If we're becoming active, check and report layout changes immediately.\r\n                if (newState === RX.Types.AppActivationState.Active) {\r\n                    ViewBase._checkViews();\r\n                }\r\n                ViewBase._viewCheckingTimer = Timers_1.default.setInterval(ViewBase._checkViews, newState === RX.Types.AppActivationState.Active ?\r\n                    _layoutTimerActiveDuration : _layoutTimerInactiveDuration);\r\n            }\r\n        }\r\n    };\r\n    ViewBase.prototype.UNSAFE_componentWillReceiveProps = function (nextProps) {\r\n        if (!!this.props.onLayout !== !!nextProps.onLayout) {\r\n            if (this.props.onLayout) {\r\n                this._checkViewCheckerUnbuild();\r\n            }\r\n            if (nextProps.onLayout) {\r\n                this._checkViewCheckerBuild();\r\n            }\r\n        }\r\n    };\r\n    ViewBase._checkViews = function () {\r\n        _.each(ViewBase._viewCheckingList, function (view) {\r\n            view._checkAndReportLayout().catch(function (e) {\r\n                console.warn('ScrollView onLayout exception: ' + JSON.stringify(e));\r\n            });\r\n        });\r\n    };\r\n    ViewBase._reportLayoutChange = function (func) {\r\n        this._layoutReportList.push(func);\r\n        if (!ViewBase._layoutReportingTimer) {\r\n            ViewBase._layoutReportingTimer = Timers_1.default.setTimeout(function () {\r\n                ViewBase._layoutReportingTimer = undefined;\r\n                ViewBase._reportDeferredLayoutChanges();\r\n            }, 0);\r\n        }\r\n    };\r\n    ViewBase._reportDeferredLayoutChanges = function () {\r\n        var reportList = this._layoutReportList;\r\n        this._layoutReportList = [];\r\n        _.each(reportList, function (func) {\r\n            try {\r\n                func();\r\n            }\r\n            catch (e) {\r\n                if (AppConfig_1.default.isDevelopmentMode()) {\r\n                    console.error('Caught exception on onLayout response: ', e);\r\n                }\r\n            }\r\n        });\r\n    };\r\n    // Returns a promise to indicate when firing of onLayout event has completed (if any)\r\n    ViewBase.prototype._checkAndReportLayout = function () {\r\n        var _this = this;\r\n        if (!this._isMounted) {\r\n            return Promise.resolve(void 0);\r\n        }\r\n        var container = this._getContainer();\r\n        if (!container) {\r\n            return Promise.resolve(void 0);\r\n        }\r\n        var newX = container.offsetLeft;\r\n        var newY = container.offsetTop;\r\n        var marginTop = !container.style.marginTop ? 0 : parseInt(container.style.marginTop, 10) || 0;\r\n        var marginBottom = !container.style.marginBottom ? 0 : parseInt(container.style.marginBottom, 10) || 0;\r\n        var marginRight = !container.style.marginRight ? 0 : parseInt(container.style.marginRight, 10) || 0;\r\n        var marginLeft = !container.style.marginLeft ? 0 : parseInt(container.style.marginLeft, 10) || 0;\r\n        var newWidth = container.offsetWidth + marginRight + marginLeft;\r\n        var newHeight = container.offsetHeight + marginTop + marginBottom;\r\n        if (this._lastX !== newX || this._lastY !== newY || this._lastWidth !== newWidth || this._lastHeight !== newHeight) {\r\n            this._lastX = newX;\r\n            this._lastY = newY;\r\n            this._lastWidth = newWidth;\r\n            this._lastHeight = newHeight;\r\n            var deferred_1 = new PromiseDefer_1.Defer();\r\n            ViewBase._reportLayoutChange(function () {\r\n                if (!_this._isMounted || !_this.props.onLayout) {\r\n                    deferred_1.resolve(void 0);\r\n                    return;\r\n                }\r\n                _this.props.onLayout({\r\n                    x: newX,\r\n                    y: newY,\r\n                    width: _this._lastWidth,\r\n                    height: _this._lastHeight,\r\n                });\r\n                deferred_1.resolve(void 0);\r\n            });\r\n            return deferred_1.promise();\r\n        }\r\n        return Promise.resolve(void 0);\r\n    };\r\n    ViewBase.prototype._checkViewCheckerBuild = function () {\r\n        // Enable the timer to check for layout changes. Use a different duration\r\n        // when the app is active versus inactive.\r\n        if (!ViewBase._viewCheckingTimer) {\r\n            ViewBase._viewCheckingTimer = Timers_1.default.setInterval(ViewBase._checkViews, ViewBase._appActivationState === RX.Types.AppActivationState.Active ?\r\n                _layoutTimerActiveDuration : _layoutTimerInactiveDuration);\r\n        }\r\n        if (!ViewBase._isResizeHandlerInstalled) {\r\n            window.addEventListener('resize', ViewBase._onResize);\r\n            ViewBase._isResizeHandlerInstalled = true;\r\n        }\r\n        ViewBase._viewCheckingList.push(this);\r\n    };\r\n    ViewBase.prototype._checkViewCheckerUnbuild = function () {\r\n        var _this = this;\r\n        ViewBase._viewCheckingList = _.filter(ViewBase._viewCheckingList, function (v) { return v !== _this; });\r\n        if (ViewBase._viewCheckingList.length === 0) {\r\n            if (ViewBase._viewCheckingTimer) {\r\n                Timers_1.default.clearInterval(ViewBase._viewCheckingTimer);\r\n                ViewBase._viewCheckingTimer = undefined;\r\n            }\r\n            if (ViewBase._isResizeHandlerInstalled) {\r\n                window.removeEventListener('resize', ViewBase._onResize);\r\n                ViewBase._isResizeHandlerInstalled = false;\r\n            }\r\n        }\r\n    };\r\n    ViewBase.prototype.componentDidMount = function () {\r\n        this._isMounted = true;\r\n        if (this.props.onLayout) {\r\n            this._checkViewCheckerBuild();\r\n        }\r\n        // Chain through to the same render-checking code\r\n        this.componentDidUpdate();\r\n    };\r\n    ViewBase.prototype.componentDidUpdate = function () {\r\n        var _this = this;\r\n        var isPopupDisplayed = FrontLayerViewManager_1.default.isPopupDisplayed();\r\n        if (this.props.onLayout) {\r\n            if (isPopupDisplayed && !this._isPopupDisplayed) {\r\n                // A popup was just added to DOM. Checking layout now would stall script\r\n                // execution because the browser would have to do a reflow. Avoid that\r\n                // by deferring the work.\r\n                setTimeout(function () {\r\n                    _this._checkAndReportLayout().catch(function (e) {\r\n                        console.warn('ScrollView onLayout exception: ' + JSON.stringify(e));\r\n                    });\r\n                }, 0);\r\n            }\r\n            else {\r\n                this._checkAndReportLayout().catch(function (e) {\r\n                    console.warn('ScrollView onLayout exception: ' + JSON.stringify(e));\r\n                });\r\n            }\r\n        }\r\n        this._isPopupDisplayed = isPopupDisplayed;\r\n    };\r\n    ViewBase._onResize = function () {\r\n        // Often views change size in response to an overall window resize. Rather than\r\n        // wait for the next timer to fire, do it immediately.\r\n        ViewBase._checkViews();\r\n    };\r\n    ViewBase.prototype.componentWillUnmount = function () {\r\n        this._isMounted = false;\r\n        if (this.props.onLayout) {\r\n            this._checkViewCheckerUnbuild();\r\n        }\r\n    };\r\n    ViewBase._isResizeHandlerInstalled = false;\r\n    ViewBase._viewCheckingList = [];\r\n    ViewBase._appActivationState = RX.Types.AppActivationState.Active;\r\n    ViewBase._layoutReportList = [];\r\n    return ViewBase;\r\n}(RX.ViewBase));\r\nexports.ViewBase = ViewBase;\r\nexports.default = ViewBase;\r\n"]},"metadata":{},"sourceType":"script"}