{"ast":null,"code":"\"use strict\";\n/**\r\n * AppVisibilityUtils.ts\r\n *\r\n * Copyright (c) Microsoft Corporation. All rights reserved.\r\n * Licensed under the MIT license.\r\n *\r\n * Web-specific helpers for firing focus/activity related events\r\n */\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.AppVisibilityUtils = void 0;\n\nvar subscribableevent_1 = require(\"subscribableevent\");\n\nvar Timers_1 = require(\"../../common/utils/Timers\");\n\nvar lodashMini_1 = require(\"./lodashMini\");\n\nvar idleTimeInMs = 60 * 1000;\n\nvar AppVisibilityUtils =\n/** @class */\nfunction () {\n  function AppVisibilityUtils() {\n    var _this = this;\n\n    this._isIdle = false;\n    this.onFocusedEvent = new subscribableevent_1.default();\n    this.onBlurredEvent = new subscribableevent_1.default();\n    this.onAppForegroundedEvent = new subscribableevent_1.default();\n    this.onAppBackgroundedEvent = new subscribableevent_1.default();\n    this.onIdleEvent = new subscribableevent_1.default();\n    this.onWakeUpEvent = new subscribableevent_1.default();\n\n    this._wakeUpAndSetTimerForIdle = function () {\n      if (!lodashMini_1.isUndefined(_this._timer)) {\n        Timers_1.default.clearTimeout(_this._timer);\n      }\n\n      if (!_this.hasFocus()) {\n        return;\n      }\n\n      if (_this.hasFocus() && _this._isIdle) {\n        _this._onWakeUp();\n      }\n\n      _this._timer = Timers_1.default.setTimeout(function () {\n        if (_this.hasFocus()) {\n          _this._onIdle();\n        }\n      }, idleTimeInMs);\n    };\n\n    this._onFocus = function () {\n      _this._wakeUpAndSetTimerForIdle();\n\n      _this.onFocusedEvent.fire();\n    };\n\n    this._onBlur = function () {\n      _this._onIdle();\n\n      _this.onBlurredEvent.fire();\n    };\n\n    this._onAppVisibilityChanged = function () {\n      if (document.hidden) {\n        _this.onAppBackgroundedEvent.fire();\n      } else {\n        _this.onAppForegroundedEvent.fire();\n      }\n    };\n\n    this._onWakeUp = function () {\n      _this._isIdle = false;\n\n      _this.onWakeUpEvent.fire();\n    };\n\n    this._onIdle = function () {\n      _this._isIdle = true;\n\n      _this.onIdleEvent.fire();\n    }; // Handle test environment where document is not defined.\n\n\n    if (typeof document !== 'undefined') {\n      window.addEventListener('focus', this._onFocus);\n      window.addEventListener('blur', this._onBlur);\n      document.addEventListener('visibilitychange', this._onAppVisibilityChanged);\n\n      this._trackIdleStatus();\n    }\n  }\n\n  AppVisibilityUtils.prototype.hasFocusAndActive = function () {\n    // Handle test environment where document is not defined.\n    if (typeof document !== 'undefined') {\n      return document.hasFocus() && !this._isIdle;\n    }\n\n    return true;\n  };\n\n  AppVisibilityUtils.prototype.hasFocus = function () {\n    // Handle test environment where document is not defined.\n    if (typeof document !== 'undefined') {\n      return document.hasFocus();\n    }\n\n    return true;\n  };\n\n  AppVisibilityUtils.prototype.isAppInForeground = function () {\n    // Handle test environment where document is not defined.\n    if (typeof document !== 'undefined') {\n      return !document.hidden;\n    }\n\n    return true;\n  };\n\n  AppVisibilityUtils.prototype._trackIdleStatus = function () {\n    document.addEventListener('mousemove', this._wakeUpAndSetTimerForIdle);\n    document.addEventListener('keyup', this._wakeUpAndSetTimerForIdle);\n    document.addEventListener('touchstart', this._wakeUpAndSetTimerForIdle);\n    document.addEventListener('scroll', this._wakeUpAndSetTimerForIdle);\n\n    this._wakeUpAndSetTimerForIdle();\n  };\n\n  return AppVisibilityUtils;\n}();\n\nexports.AppVisibilityUtils = AppVisibilityUtils;\nexports.default = new AppVisibilityUtils();","map":{"version":3,"sources":["/Users/trungthang/Documents/webStreamGame/node_modules/react-ult/dist/web/utils/AppVisibilityUtils.js"],"names":["Object","defineProperty","exports","value","AppVisibilityUtils","subscribableevent_1","require","Timers_1","lodashMini_1","idleTimeInMs","_this","_isIdle","onFocusedEvent","default","onBlurredEvent","onAppForegroundedEvent","onAppBackgroundedEvent","onIdleEvent","onWakeUpEvent","_wakeUpAndSetTimerForIdle","isUndefined","_timer","clearTimeout","hasFocus","_onWakeUp","setTimeout","_onIdle","_onFocus","fire","_onBlur","_onAppVisibilityChanged","document","hidden","window","addEventListener","_trackIdleStatus","prototype","hasFocusAndActive","isAppInForeground"],"mappings":"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","sourcesContent":["\"use strict\";\r\n/**\r\n * AppVisibilityUtils.ts\r\n *\r\n * Copyright (c) Microsoft Corporation. All rights reserved.\r\n * Licensed under the MIT license.\r\n *\r\n * Web-specific helpers for firing focus/activity related events\r\n */\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.AppVisibilityUtils = void 0;\r\nvar subscribableevent_1 = require(\"subscribableevent\");\r\nvar Timers_1 = require(\"../../common/utils/Timers\");\r\nvar lodashMini_1 = require(\"./lodashMini\");\r\nvar idleTimeInMs = 60 * 1000;\r\nvar AppVisibilityUtils = /** @class */ (function () {\r\n    function AppVisibilityUtils() {\r\n        var _this = this;\r\n        this._isIdle = false;\r\n        this.onFocusedEvent = new subscribableevent_1.default();\r\n        this.onBlurredEvent = new subscribableevent_1.default();\r\n        this.onAppForegroundedEvent = new subscribableevent_1.default();\r\n        this.onAppBackgroundedEvent = new subscribableevent_1.default();\r\n        this.onIdleEvent = new subscribableevent_1.default();\r\n        this.onWakeUpEvent = new subscribableevent_1.default();\r\n        this._wakeUpAndSetTimerForIdle = function () {\r\n            if (!lodashMini_1.isUndefined(_this._timer)) {\r\n                Timers_1.default.clearTimeout(_this._timer);\r\n            }\r\n            if (!_this.hasFocus()) {\r\n                return;\r\n            }\r\n            if (_this.hasFocus() && _this._isIdle) {\r\n                _this._onWakeUp();\r\n            }\r\n            _this._timer = Timers_1.default.setTimeout(function () {\r\n                if (_this.hasFocus()) {\r\n                    _this._onIdle();\r\n                }\r\n            }, idleTimeInMs);\r\n        };\r\n        this._onFocus = function () {\r\n            _this._wakeUpAndSetTimerForIdle();\r\n            _this.onFocusedEvent.fire();\r\n        };\r\n        this._onBlur = function () {\r\n            _this._onIdle();\r\n            _this.onBlurredEvent.fire();\r\n        };\r\n        this._onAppVisibilityChanged = function () {\r\n            if (document.hidden) {\r\n                _this.onAppBackgroundedEvent.fire();\r\n            }\r\n            else {\r\n                _this.onAppForegroundedEvent.fire();\r\n            }\r\n        };\r\n        this._onWakeUp = function () {\r\n            _this._isIdle = false;\r\n            _this.onWakeUpEvent.fire();\r\n        };\r\n        this._onIdle = function () {\r\n            _this._isIdle = true;\r\n            _this.onIdleEvent.fire();\r\n        };\r\n        // Handle test environment where document is not defined.\r\n        if (typeof (document) !== 'undefined') {\r\n            window.addEventListener('focus', this._onFocus);\r\n            window.addEventListener('blur', this._onBlur);\r\n            document.addEventListener('visibilitychange', this._onAppVisibilityChanged);\r\n            this._trackIdleStatus();\r\n        }\r\n    }\r\n    AppVisibilityUtils.prototype.hasFocusAndActive = function () {\r\n        // Handle test environment where document is not defined.\r\n        if (typeof (document) !== 'undefined') {\r\n            return document.hasFocus() && !this._isIdle;\r\n        }\r\n        return true;\r\n    };\r\n    AppVisibilityUtils.prototype.hasFocus = function () {\r\n        // Handle test environment where document is not defined.\r\n        if (typeof (document) !== 'undefined') {\r\n            return document.hasFocus();\r\n        }\r\n        return true;\r\n    };\r\n    AppVisibilityUtils.prototype.isAppInForeground = function () {\r\n        // Handle test environment where document is not defined.\r\n        if (typeof (document) !== 'undefined') {\r\n            return !document.hidden;\r\n        }\r\n        return true;\r\n    };\r\n    AppVisibilityUtils.prototype._trackIdleStatus = function () {\r\n        document.addEventListener('mousemove', this._wakeUpAndSetTimerForIdle);\r\n        document.addEventListener('keyup', this._wakeUpAndSetTimerForIdle);\r\n        document.addEventListener('touchstart', this._wakeUpAndSetTimerForIdle);\r\n        document.addEventListener('scroll', this._wakeUpAndSetTimerForIdle);\r\n        this._wakeUpAndSetTimerForIdle();\r\n    };\r\n    return AppVisibilityUtils;\r\n}());\r\nexports.AppVisibilityUtils = AppVisibilityUtils;\r\nexports.default = new AppVisibilityUtils();\r\n"]},"metadata":{},"sourceType":"script"}