{"ast":null,"code":"\"use strict\";\n/**\r\n * FrontLayerViewManager.tsx\r\n *\r\n * Copyright (c) Microsoft Corporation. All rights reserved.\r\n * Licensed under the MIT license.\r\n *\r\n * Manages the layering of the main view, modals and popups.\r\n */\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.FrontLayerViewManager = void 0;\n\nvar React = require(\"react\");\n\nvar ReactDOM = require(\"react-dom\");\n\nvar Timers_1 = require(\"../common/utils/Timers\");\n\nvar MouseResponder_1 = require(\"./utils/MouseResponder\");\n\nvar RootView_1 = require(\"./RootView\");\n\nvar MAX_CACHED_POPUPS = 4;\n\nvar FrontLayerViewManager =\n/** @class */\nfunction () {\n  function FrontLayerViewManager() {\n    var _this = this;\n\n    this._modalStack = [];\n    this._activePopupAutoDismiss = false;\n    this._activePopupAutoDismissDelay = 0;\n    this._activePopupShowDelay = 0;\n    this._cachedPopups = []; // We need to be careful accessing document because it may not be defined\n    // in some environments like Electron.\n\n    this._isRtlDefault = typeof document !== 'undefined' && typeof document.documentElement !== 'undefined' && document.documentElement.dir === 'rtl';\n    this._isRtlAllowed = true;\n    this._isRtlForced = false;\n\n    this._shouldPopupBeDismissed = function (options) {\n      return !!_this._activePopupOptions && _this._activePopupOptions.getAnchor() === options.getAnchor();\n    };\n  }\n\n  FrontLayerViewManager.prototype.setMainView = function (element) {\n    this._mainView = element;\n\n    this._renderRootView();\n  };\n\n  FrontLayerViewManager.prototype.isModalDisplayed = function (modalId) {\n    if (modalId) {\n      return this._modalStack.some(function (d) {\n        return d.id === modalId;\n      });\n    } else {\n      return this._modalStack.length > 0;\n    }\n  };\n\n  FrontLayerViewManager.prototype.showModal = function (modal, modalId, options) {\n    // Dismiss any active popups.\n    if (this._activePopupOptions) {\n      this.dismissPopup(this._activePopupId);\n    }\n\n    this._modalStack.push({\n      modal: modal,\n      id: modalId\n    });\n\n    this._renderRootView();\n  };\n\n  FrontLayerViewManager.prototype.dismissModal = function (modalId) {\n    this._modalStack = this._modalStack.filter(function (d) {\n      return d.id !== modalId;\n    });\n\n    this._renderRootView();\n  };\n\n  FrontLayerViewManager.prototype.dismissAllModals = function () {\n    if (this._modalStack.length > 0) {\n      this._modalStack = [];\n\n      this._renderRootView();\n    }\n  };\n\n  FrontLayerViewManager.prototype._updateModalDisplayedState = function () {\n    MouseResponder_1.default.setModalIsDisplayed(this.isModalDisplayed());\n  };\n\n  FrontLayerViewManager.prototype.showPopup = function (options, popupId, showDelay) {\n    // If options.dismissIfShown is true, calling this method will behave like a toggle.\n    // On one call, it will open the popup. If it is called when pop up is seen, it will\n    // dismiss the popup. If options.dismissIfShown is false, we will simply show the\n    // popup always.\n    if (options.dismissIfShown) {\n      if (this._shouldPopupBeDismissed(options)) {\n        this.dismissPopup(popupId);\n        return false;\n      }\n    }\n\n    this._showPopup(options, popupId, showDelay);\n\n    return true;\n  };\n\n  FrontLayerViewManager.prototype._showPopup = function (options, popupId, showDelay) {\n    var _this = this; // New popup is transitioning from maybe cached to active.\n\n\n    this._cachedPopups = this._cachedPopups.filter(function (popup) {\n      return popup.popupId !== popupId;\n    });\n\n    if (this._activePopupOptions && this._activePopupOptions.cacheable && this._activePopupId !== popupId) {\n      // Old popup is transitioning from active to cached.\n      this._cachedPopups.push({\n        popupOptions: this._activePopupOptions,\n        popupId: this._activePopupId\n      });\n\n      this._cachedPopups = this._cachedPopups.slice(-MAX_CACHED_POPUPS);\n    } // Update fields before calling onDismiss to guard against reentry.\n\n\n    var oldPopupOptions = this._activePopupOptions;\n    this._activePopupOptions = options;\n    this._activePopupId = popupId;\n    this._activePopupAutoDismiss = false;\n    this._activePopupAutoDismissDelay = 0;\n    this._activePopupShowDelay = showDelay || 0;\n\n    if (this._popupShowDelayTimer) {\n      Timers_1.default.clearTimeout(this._popupShowDelayTimer);\n      this._popupShowDelayTimer = undefined;\n    }\n\n    if (this._activePopupShowDelay > 0) {\n      this._popupShowDelayTimer = Timers_1.default.setTimeout(function () {\n        _this._activePopupShowDelay = 0;\n        _this._popupShowDelayTimer = undefined;\n\n        _this._renderRootView();\n      }, this._activePopupShowDelay);\n    }\n\n    if (oldPopupOptions) {\n      if (oldPopupOptions.onDismiss) {\n        oldPopupOptions.onDismiss();\n      }\n    }\n\n    this._renderRootView();\n  };\n\n  FrontLayerViewManager.prototype.autoDismissPopup = function (popupId, dismissDelay) {\n    if (popupId === this._activePopupId && this._activePopupOptions) {\n      if (this._popupShowDelayTimer) {\n        Timers_1.default.clearTimeout(this._popupShowDelayTimer);\n        this._popupShowDelayTimer = undefined;\n      }\n\n      this._activePopupAutoDismiss = true;\n      this._activePopupAutoDismissDelay = dismissDelay || 0;\n\n      this._renderRootView();\n    }\n  };\n\n  FrontLayerViewManager.prototype.dismissPopup = function (popupId) {\n    if (popupId === this._activePopupId && this._activePopupOptions) {\n      if (this._popupShowDelayTimer) {\n        Timers_1.default.clearTimeout(this._popupShowDelayTimer);\n        this._popupShowDelayTimer = undefined;\n      }\n\n      if (this._activePopupOptions.cacheable) {\n        // The popup is transitioning from active to cached.\n        this._cachedPopups.push({\n          popupOptions: this._activePopupOptions,\n          popupId: this._activePopupId\n        });\n\n        this._cachedPopups = this._cachedPopups.slice(-MAX_CACHED_POPUPS);\n      } // Reset fields before calling onDismiss to guard against reentry.\n\n\n      var activePopupOptions = this._activePopupOptions;\n      this._activePopupOptions = undefined;\n      this._activePopupId = undefined;\n\n      if (activePopupOptions.onDismiss) {\n        activePopupOptions.onDismiss();\n      }\n\n      this._renderRootView();\n    }\n  };\n\n  FrontLayerViewManager.prototype.dismissAllPopups = function () {\n    if (this._activePopupId) {\n      this.dismissPopup(this._activePopupId);\n    }\n  };\n\n  FrontLayerViewManager.prototype._renderRootView = function () {\n    var _this = this;\n\n    var topModal = this._modalStack.length > 0 ? this._modalStack[this._modalStack.length - 1].modal : undefined;\n    var activePopup = !this._activePopupOptions || this._activePopupShowDelay > 0 ? undefined : {\n      popupOptions: this._activePopupOptions,\n      popupId: this._activePopupId\n    };\n\n    this._updateModalDisplayedState();\n\n    var rootView = React.createElement(RootView_1.RootView, {\n      mainView: this._mainView,\n      keyBoardFocusOutline: this._mainView.props.keyBoardFocusOutline,\n      mouseFocusOutline: this._mainView.props.mouseFocusOutline,\n      modal: topModal,\n      activePopup: activePopup,\n      cachedPopup: this._cachedPopups,\n      autoDismiss: this._activePopupAutoDismiss,\n      autoDismissDelay: this._activePopupAutoDismissDelay,\n      onDismissPopup: function () {\n        return _this.dismissPopup(_this._activePopupId);\n      },\n      writingDirection: this._isRtlForced ? 'rtl' : this._isRtlAllowed ? 'auto' : 'ltr'\n    });\n    var container = document.getElementsByClassName('app-container')[0];\n    ReactDOM.render(rootView, container);\n  };\n\n  FrontLayerViewManager.prototype.isPopupDisplayed = function (popupId) {\n    if (popupId) {\n      return popupId === this._activePopupId;\n    } else {\n      return !!this._activePopupId;\n    }\n  };\n\n  FrontLayerViewManager.prototype.allowRTL = function (allow) {\n    if (this._isRtlAllowed !== allow) {\n      this._isRtlAllowed = allow;\n\n      this._renderRootView();\n    }\n  };\n\n  FrontLayerViewManager.prototype.forceRTL = function (force) {\n    if (this._isRtlForced !== force) {\n      this._isRtlForced = force;\n\n      this._renderRootView();\n    }\n  };\n\n  FrontLayerViewManager.prototype.isRTL = function () {\n    return this._isRtlForced || this._isRtlDefault && this._isRtlAllowed;\n  };\n\n  return FrontLayerViewManager;\n}();\n\nexports.FrontLayerViewManager = FrontLayerViewManager;\nexports.default = new FrontLayerViewManager();","map":{"version":3,"sources":["/Users/trungthang/Documents/webStreamGame/node_modules/react-ult/dist/web/FrontLayerViewManager.js"],"names":["Object","defineProperty","exports","value","FrontLayerViewManager","React","require","ReactDOM","Timers_1","MouseResponder_1","RootView_1","MAX_CACHED_POPUPS","_this","_modalStack","_activePopupAutoDismiss","_activePopupAutoDismissDelay","_activePopupShowDelay","_cachedPopups","_isRtlDefault","document","documentElement","dir","_isRtlAllowed","_isRtlForced","_shouldPopupBeDismissed","options","_activePopupOptions","getAnchor","prototype","setMainView","element","_mainView","_renderRootView","isModalDisplayed","modalId","some","d","id","length","showModal","modal","dismissPopup","_activePopupId","push","dismissModal","filter","dismissAllModals","_updateModalDisplayedState","default","setModalIsDisplayed","showPopup","popupId","showDelay","dismissIfShown","_showPopup","popup","cacheable","popupOptions","slice","oldPopupOptions","_popupShowDelayTimer","clearTimeout","undefined","setTimeout","onDismiss","autoDismissPopup","dismissDelay","activePopupOptions","dismissAllPopups","topModal","activePopup","rootView","createElement","RootView","mainView","keyBoardFocusOutline","props","mouseFocusOutline","cachedPopup","autoDismiss","autoDismissDelay","onDismissPopup","writingDirection","container","getElementsByClassName","render","isPopupDisplayed","allowRTL","allow","forceRTL","force","isRTL"],"mappings":"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","sourcesContent":["\"use strict\";\r\n/**\r\n * FrontLayerViewManager.tsx\r\n *\r\n * Copyright (c) Microsoft Corporation. All rights reserved.\r\n * Licensed under the MIT license.\r\n *\r\n * Manages the layering of the main view, modals and popups.\r\n */\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.FrontLayerViewManager = void 0;\r\nvar React = require(\"react\");\r\nvar ReactDOM = require(\"react-dom\");\r\nvar Timers_1 = require(\"../common/utils/Timers\");\r\nvar MouseResponder_1 = require(\"./utils/MouseResponder\");\r\nvar RootView_1 = require(\"./RootView\");\r\nvar MAX_CACHED_POPUPS = 4;\r\nvar FrontLayerViewManager = /** @class */ (function () {\r\n    function FrontLayerViewManager() {\r\n        var _this = this;\r\n        this._modalStack = [];\r\n        this._activePopupAutoDismiss = false;\r\n        this._activePopupAutoDismissDelay = 0;\r\n        this._activePopupShowDelay = 0;\r\n        this._cachedPopups = [];\r\n        // We need to be careful accessing document because it may not be defined\r\n        // in some environments like Electron.\r\n        this._isRtlDefault = typeof document !== 'undefined' &&\r\n            typeof document.documentElement !== 'undefined' && document.documentElement.dir === 'rtl';\r\n        this._isRtlAllowed = true;\r\n        this._isRtlForced = false;\r\n        this._shouldPopupBeDismissed = function (options) { return (!!_this._activePopupOptions &&\r\n            _this._activePopupOptions.getAnchor() === options.getAnchor()); };\r\n    }\r\n    FrontLayerViewManager.prototype.setMainView = function (element) {\r\n        this._mainView = element;\r\n        this._renderRootView();\r\n    };\r\n    FrontLayerViewManager.prototype.isModalDisplayed = function (modalId) {\r\n        if (modalId) {\r\n            return this._modalStack.some(function (d) { return d.id === modalId; });\r\n        }\r\n        else {\r\n            return this._modalStack.length > 0;\r\n        }\r\n    };\r\n    FrontLayerViewManager.prototype.showModal = function (modal, modalId, options) {\r\n        // Dismiss any active popups.\r\n        if (this._activePopupOptions) {\r\n            this.dismissPopup(this._activePopupId);\r\n        }\r\n        this._modalStack.push({ modal: modal, id: modalId });\r\n        this._renderRootView();\r\n    };\r\n    FrontLayerViewManager.prototype.dismissModal = function (modalId) {\r\n        this._modalStack = this._modalStack.filter(function (d) { return d.id !== modalId; });\r\n        this._renderRootView();\r\n    };\r\n    FrontLayerViewManager.prototype.dismissAllModals = function () {\r\n        if (this._modalStack.length > 0) {\r\n            this._modalStack = [];\r\n            this._renderRootView();\r\n        }\r\n    };\r\n    FrontLayerViewManager.prototype._updateModalDisplayedState = function () {\r\n        MouseResponder_1.default.setModalIsDisplayed(this.isModalDisplayed());\r\n    };\r\n    FrontLayerViewManager.prototype.showPopup = function (options, popupId, showDelay) {\r\n        // If options.dismissIfShown is true, calling this method will behave like a toggle.\r\n        // On one call, it will open the popup. If it is called when pop up is seen, it will\r\n        // dismiss the popup. If options.dismissIfShown is false, we will simply show the\r\n        // popup always.\r\n        if (options.dismissIfShown) {\r\n            if (this._shouldPopupBeDismissed(options)) {\r\n                this.dismissPopup(popupId);\r\n                return false;\r\n            }\r\n        }\r\n        this._showPopup(options, popupId, showDelay);\r\n        return true;\r\n    };\r\n    FrontLayerViewManager.prototype._showPopup = function (options, popupId, showDelay) {\r\n        var _this = this;\r\n        // New popup is transitioning from maybe cached to active.\r\n        this._cachedPopups = this._cachedPopups.filter(function (popup) { return popup.popupId !== popupId; });\r\n        if (this._activePopupOptions && this._activePopupOptions.cacheable && this._activePopupId !== popupId) {\r\n            // Old popup is transitioning from active to cached.\r\n            this._cachedPopups.push({ popupOptions: this._activePopupOptions, popupId: this._activePopupId });\r\n            this._cachedPopups = this._cachedPopups.slice(-MAX_CACHED_POPUPS);\r\n        }\r\n        // Update fields before calling onDismiss to guard against reentry.\r\n        var oldPopupOptions = this._activePopupOptions;\r\n        this._activePopupOptions = options;\r\n        this._activePopupId = popupId;\r\n        this._activePopupAutoDismiss = false;\r\n        this._activePopupAutoDismissDelay = 0;\r\n        this._activePopupShowDelay = showDelay || 0;\r\n        if (this._popupShowDelayTimer) {\r\n            Timers_1.default.clearTimeout(this._popupShowDelayTimer);\r\n            this._popupShowDelayTimer = undefined;\r\n        }\r\n        if (this._activePopupShowDelay > 0) {\r\n            this._popupShowDelayTimer = Timers_1.default.setTimeout(function () {\r\n                _this._activePopupShowDelay = 0;\r\n                _this._popupShowDelayTimer = undefined;\r\n                _this._renderRootView();\r\n            }, this._activePopupShowDelay);\r\n        }\r\n        if (oldPopupOptions) {\r\n            if (oldPopupOptions.onDismiss) {\r\n                oldPopupOptions.onDismiss();\r\n            }\r\n        }\r\n        this._renderRootView();\r\n    };\r\n    FrontLayerViewManager.prototype.autoDismissPopup = function (popupId, dismissDelay) {\r\n        if (popupId === this._activePopupId && this._activePopupOptions) {\r\n            if (this._popupShowDelayTimer) {\r\n                Timers_1.default.clearTimeout(this._popupShowDelayTimer);\r\n                this._popupShowDelayTimer = undefined;\r\n            }\r\n            this._activePopupAutoDismiss = true;\r\n            this._activePopupAutoDismissDelay = dismissDelay || 0;\r\n            this._renderRootView();\r\n        }\r\n    };\r\n    FrontLayerViewManager.prototype.dismissPopup = function (popupId) {\r\n        if (popupId === this._activePopupId && this._activePopupOptions) {\r\n            if (this._popupShowDelayTimer) {\r\n                Timers_1.default.clearTimeout(this._popupShowDelayTimer);\r\n                this._popupShowDelayTimer = undefined;\r\n            }\r\n            if (this._activePopupOptions.cacheable) {\r\n                // The popup is transitioning from active to cached.\r\n                this._cachedPopups.push({ popupOptions: this._activePopupOptions, popupId: this._activePopupId });\r\n                this._cachedPopups = this._cachedPopups.slice(-MAX_CACHED_POPUPS);\r\n            }\r\n            // Reset fields before calling onDismiss to guard against reentry.\r\n            var activePopupOptions = this._activePopupOptions;\r\n            this._activePopupOptions = undefined;\r\n            this._activePopupId = undefined;\r\n            if (activePopupOptions.onDismiss) {\r\n                activePopupOptions.onDismiss();\r\n            }\r\n            this._renderRootView();\r\n        }\r\n    };\r\n    FrontLayerViewManager.prototype.dismissAllPopups = function () {\r\n        if (this._activePopupId) {\r\n            this.dismissPopup(this._activePopupId);\r\n        }\r\n    };\r\n    FrontLayerViewManager.prototype._renderRootView = function () {\r\n        var _this = this;\r\n        var topModal = this._modalStack.length > 0 ?\r\n            this._modalStack[this._modalStack.length - 1].modal : undefined;\r\n        var activePopup = (!this._activePopupOptions || this._activePopupShowDelay > 0) ? undefined :\r\n            { popupOptions: this._activePopupOptions, popupId: this._activePopupId };\r\n        this._updateModalDisplayedState();\r\n        var rootView = (React.createElement(RootView_1.RootView, { mainView: this._mainView, keyBoardFocusOutline: this._mainView.props.keyBoardFocusOutline, mouseFocusOutline: this._mainView.props.mouseFocusOutline, modal: topModal, activePopup: activePopup, cachedPopup: this._cachedPopups, autoDismiss: this._activePopupAutoDismiss, autoDismissDelay: this._activePopupAutoDismissDelay, onDismissPopup: function () { return _this.dismissPopup(_this._activePopupId); }, writingDirection: this._isRtlForced ? 'rtl' : (this._isRtlAllowed ? 'auto' : 'ltr') }));\r\n        var container = document.getElementsByClassName('app-container')[0];\r\n        ReactDOM.render(rootView, container);\r\n    };\r\n    FrontLayerViewManager.prototype.isPopupDisplayed = function (popupId) {\r\n        if (popupId) {\r\n            return popupId === this._activePopupId;\r\n        }\r\n        else {\r\n            return !!this._activePopupId;\r\n        }\r\n    };\r\n    FrontLayerViewManager.prototype.allowRTL = function (allow) {\r\n        if (this._isRtlAllowed !== allow) {\r\n            this._isRtlAllowed = allow;\r\n            this._renderRootView();\r\n        }\r\n    };\r\n    FrontLayerViewManager.prototype.forceRTL = function (force) {\r\n        if (this._isRtlForced !== force) {\r\n            this._isRtlForced = force;\r\n            this._renderRootView();\r\n        }\r\n    };\r\n    FrontLayerViewManager.prototype.isRTL = function () {\r\n        return this._isRtlForced || (this._isRtlDefault && this._isRtlAllowed);\r\n    };\r\n    return FrontLayerViewManager;\r\n}());\r\nexports.FrontLayerViewManager = FrontLayerViewManager;\r\nexports.default = new FrontLayerViewManager();\r\n"]},"metadata":{},"sourceType":"script"}